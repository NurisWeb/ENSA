<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Teppichreinigung Kostenrechner</title>
  <!-- Laden von Tailwind CSS für das Kontaktformular -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.7/dist/tailwind.min.css" rel="stylesheet">
  <style>
    /* Ihr CSS-Code bleibt weitgehend unverändert */
    .calculator {
      background-color: white;
      border-radius: 10px;
      padding: 44px 60px;
      width: 100%;
      position: relative;
      letter-spacing: 0.8px;
      font-weight: 700;
      display: flex;
      flex-direction: column;
      align-items: center;
      max-height: 100%;
      max-width: 800px;
      overflow-y: auto;
      overflow-x: hidden;
    }

    .title {
      text-align: center;
      margin-bottom: 20px;
      font-size: 2rem;
    }

    .slider-container {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      margin-bottom: 20px;
      width: 100%;
    }

    .slider-container label {
      margin-bottom: 16px;
    }

    .slider-container input[type="range"] {
      width: 100%;
    }

    .price-buttons {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 40px;
    }

    .tooltip > input {
      margin-right: 0.5rem;
    }

    .price-button {
      padding: 10px 20px;
      cursor: pointer;
      border: none;
      border-radius: 5px;
      background-color: #f0f0f0;
      transition: all 0.3s ease;
      font-size: 16px;
      color: black;
      width: 98%;
    }

    .price-button.active {
      background-color: #3041df;
      color: white;
    }

    #currentCarpetPrice {
      font-size: 18px;
      font-weight: bold;
      text-align: center;
      color: black;
    }

    #total {
      font-size: 24px;
      font-weight: bold;
      text-align: center;
      margin-top: 28px;
      color: black;
    }

    .additional-options {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .additional-options .option {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .additional-options label {
      position: relative;
      display: inline-block;
      font-weight: bold;
      cursor: pointer;
    }

    .slider-wrapper {
      display: flex;
      justify-content: space-between;
      width: 100%;
      gap: 40px;
      margin: 4px;
    }

    .tooltiptext {
      visibility: hidden;
      width: 280px;
      background-color: #555;
      color: #fff;
      text-align: left;
      border-radius: 6px;
      padding: 10px;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      margin-left: -140px;
      opacity: 0;
      transition: opacity 0.3s;
      font-weight: normal;
    }

    .tooltiptext::after {
      content: "";
      position: absolute;
      top: 100%;
      left: 50%;
      margin-left: -5px;
      border-width: 5px;
      border-style: solid;
      border-color: #555 transparent transparent transparent;
    }

    .tooltip:hover .tooltiptext {
      visibility: visible;
      opacity: 1;
    }

    .button {
      background-color: #2d6aff;
      border-radius: 50px;
      border: 2px solid white;
      box-shadow: rgb(0 0 0 / 40%) 0px 7px 29px 0px;
      color: white;
      padding: 15px 25px;
      margin: 1rem 1rem;
    }

    .send-request {
      margin-top: 20px;
    }

    .add-carpet-button {
      background-color: #89ffc13b;
      padding: 6px 11px;
      border-radius: 50px;
      cursor: pointer;
      font-size: 15.5px;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
    }

    .carpet-item {
      margin-top: 10px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
    }

    .delete-button {
      background-color: #da0e0e;
      color: white;
      padding: 5px 8px;
      border: none;
      border-radius: 45px;
      cursor: pointer;
      margin-left: 10px;
    }

    /* Kontaktformular zunächst ausblenden */
    .contact-form {
      display: none;
    }

    
      .korrekt {
    margin-right: 0.5rem;
      }

    /* Responsive Design */
    @media (width <= 767px) {
      .calculator {
        padding: 20px;
        gap: 8px;
        overflow-y: auto;
        height: 100%;
      }
      .slider-wrapper {
        display: flex;
        justify-content: space-between;
        width: 100%;
        gap: 40px;
      }

      .price-button {
        font-size: 14px;
        padding: 8px 16px;
        margin: 0px 0px 16px;
        width: 100%;
      }

      .price-buttons {
        margin: 0;
        gap: 0;
      }

       #currentCarpetPrice {
        font-size: 20px;
      }

      #total{
        font-size: 24px;
        font-weight: 800;
      }

    
      .title {
        font-size: 24px;
        text-align: left;
        font-weight: 800;
        text-transform: uppercase;
        line-height: 1.2;
      }

      .tooltiptext {
        width: 200px;
        left: 50%;
        margin-left: -100px;
      }

      .slider-container label {
        margin-bottom: 25px;
      }


      label {
        font-size: 16px;
      }

      .button {
        background-color: #2d6aff;
        border-radius: 50px;
        border: 2px solid white;
        box-shadow: rgb(0 0 0 / 40%) 0px 7px 29px 0px;
        color: white;
        padding: 8px 25px;
        margin: 0rem 0rem;
        font-size: 1.1rem;
        width: 100%;
      }

      .additional-options .option {
        width: 100%;
      }

      .add-carpet-button {
        padding: 4px 12px;
        border-radius: 50px;
        cursor: pointer;
        font-size: 12px;
        border: none;
        margin-top: 16px;
        display: flex;
        align-items: center;
        gap: 4px;
      }

      .carpet-item {
        margin-top: 10px;
        padding: 5.2px;
        border: 1px solid #ddd;
        border-radius: 5px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
        font-size: 10px;
        gap: 8px;
      }

      #total, #currentCarpetPrice {
        margin-top: 0;
        margin-bottom: 8px;
      }

      #carpetList {
        margin-bottom: 24px;
      }

      #total {
        text-decoration: underline;
        text-underline-offset: 3px;
      }
    }
  </style>
</head>

<body>
  <div class="calculator">
    <h2 class="title">Teppichreinigung Kostenrechner</h2>

    <div class="slider-wrapper">
      <div class="slider-container">
        <label for="widthRange">Breite: <span id="widthValue">2</span> m</label>
        <input
          type="range"
          id="widthRange"
          min="0"
          max="10"
          step="0.1"
          value="2"
        />
      </div>

      <div class="slider-container">
        <label for="lengthRange">Länge: <span id="lengthValue">2</span> m</label>
        <input
          type="range"
          id="lengthRange"
          min="0"
          max="10"
          step="0.1"
          value="2"
        />
      </div>
    </div>

    <div class="price-buttons">
      <button class="price-button active" data-price="9.9">
        Synthetische Teppiche 9,90€ /m²
      </button>
      <button class="price-button" data-price="12.9">
        Langflorteppiche 12,90€ /m²
      </button>
      <button class="price-button" data-price="19.9">
        Traditionelle Teppiche 19,90€ /m²
      </button>
      <button class="price-button" data-price="6.9">
        Teppichboden 6,90€ /m²
      </button>
    </div>

    <div class="additional-options">
      <div class="option">
        <label class="tooltip">
          <input type="checkbox" id="geruchsbehandlungCheckbox" />
          <strong>Hygienebehandlung</strong> m² 5€
          <span class="tooltiptext">
            Optional buchbar, pro m² 5€. Sehr empfehlenswert bei
            Milbenentfernung und Geruchsbeseitigung wie zum Beispiel Urin oder
            sonstige bakterielle Verunreinigungen.
          </span>
        </label>
      </div>
      <div class="option">
        <label class="tooltip">
          <input type="checkbox" id="impraegnierungCheckbox" />
          <strong>Imprägnierung/Rückfetten</strong> m² 5€
          <span class="tooltiptext">
            Allgemein schutzabweisende Wirkung. Rückfetten für Wollteppiche,
            sehr empfehlenswert, da Wollteppiche generell Wollfett enthalten.
          </span>
        </label>
      </div>
      <div class="option">
        <label >
          <input type="checkbox" id="pickupCheckbox" class="korrekt" />
          <strong>Abhol- und Bringservice </strong>20€<span class="tooltiptext">
            Ab einen Auftragswert von 99,-€ ist der Abhol- und Bringservice kostenlos.
          </span>
        </label>
      </div>
      <div class="option">
        <button class="add-carpet-button" id="addCarpet">
          <svg
            class="w-6 h-6"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            width="6"
            height="6"
            fill="yellow"
            viewBox="0 0 24 24"
          >
            <path
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 7.757v8.486M7.757 12h8.486M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"
            />
          </svg>
          Teppich hinzufügen
        </button>
      </div>
      <div class="option">
        <div id="currentCarpetPrice"><strong>Preis des aktuellen Teppichs: 0.00 €</strong></div>
      </div>
    </div>

    <div id="total">Gesamtpreis: 0.00 €</div>

    <ul id="carpetList"></ul>

    <button class="button send-request" id="sendRequest">Anfrage senden</button>
  </div>


  <div class="contact-form">
    <section class="bg-white dark:bg-gray-900">
      <div class="py-8 lg:py-16 px-4 mx-auto max-w-screen-md">
        <h2 class="mb-4 text-4xl tracking-tight font-extrabold text-center text-gray-900 dark:text-white">Kontaktieren Sie uns</h2>
        <p class="mb-8 lg:mb-16 font-light text-center text-gray-500 dark:text-gray-400 sm:text-xl">
          Haben Sie eine Frage? Möchten Sie Feedback geben? Lassen Sie es uns wissen.
        </p>
        <form id="contactForm" class="space-y-8">
          <div>
            <label for="contactEmail" class="block mb-2 text-sm font-medium text-gray-900 dark:text-gray-300">Ihre E-Mail</label>
            <input type="email" id="contactEmail" class="shadow-sm bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" placeholder="name@beispiel.de" required>
          </div>
          <div>
            <label for="contactName" class="block mb-2 text-sm font-medium text-gray-900 dark:text-gray-300">Ihr vollständiger Name</label>
            <input type="text" id="contactName" class="shadow-sm bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" placeholder="Max Mustermann" required>
          </div>
          <div>
            <label for="contactPhone" class="block mb-2 text-sm font-medium text-gray-900 dark:text-gray-300">Ihre Telefonnummer</label>
            <input type="tel" id="contactPhone" class="shadow-sm bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" placeholder="0123 4567890" required>
          </div>
          <div>
            <label for="contactMessage" class="block mb-2 text-sm font-medium text-gray-900 dark:text-gray-300">Ihre Nachricht</label>
            <textarea id="contactMessage" rows="6" class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg shadow-sm border border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="Ihre Nachricht..."></textarea>
          </div>
          <div>
            <div>Gesamtpreis: <span id="totalPriceDisplay"></span> €</div>
          </div>

          <!-- Neue Checkbox für die Einwilligung -->
          <div class="relative z-0 mb-4 flex items-start text-left">
            <input
              type="checkbox"
              id="contactConsent"
              name="contactConsent"
              class="mt-1 mr-2"
              required
            />
            <label
              for="contactConsent"
              class="text-sm text-gray-500 dark:text-gray-400"
            >
              Ich erlaube Ihnen, mich zu kontaktieren für eine Auftragsbestätigung, Angebote und Bewertungsanfragen.
            </label>
          </div>

          <!-- Professionell formuliertes Hinweis-P-Element -->
          <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">
            Sie erhalten eine E-Mail mit einem Bestätigungslink. Bitte klicken Sie auf den Link in der E-Mail, um Ihre E-Mail-Adresse zu bestätigen.
          </p>

          <button type="button" class="py-3 px-5 text-sm font-medium text-center text-white rounded-lg bg-blue-700 sm:w-fit hover:bg-blue-800 focus:ring-4 focus:outline-none" id="submitContact">Absenden</button>
        </form>
      </div>
    </section>
  </div>

  <!-- JavaScript-Code -->
  <!-- Aktualisierte EmailJS SDK Version -->
  <script type="text/javascript" src="https://cdn.emailjs.com/sdk/3.11.0/email.min.js"></script>
  <script>
    // Initialisierung mit dem Public Key
    emailjs.init('sNn4zdWLbh96L9n8j'); // Ersetzen Sie dies durch Ihren tatsächlichen Public Key

    let width = 2;
    let length = 2;
    let selectedPrice = 9.9; // Standardmäßig Synthetische Teppiche
    let impraegnierung = false;
    let geruchsbehandlung = false;
    let pickupDesired = false;
    let totalCarpets = [];
    let totalSum = 0;

    const widthRange = document.getElementById("widthRange");
    const lengthRange = document.getElementById("lengthRange");
    const priceButtons = document.querySelectorAll(".price-button");
    const totalDisplay = document.getElementById("total");
    const currentCarpetPriceDisplay = document.getElementById("currentCarpetPrice");
    const widthValueDisplay = document.getElementById("widthValue");
    const lengthValueDisplay = document.getElementById("lengthValue");
    const geruchsbehandlungCheckbox = document.getElementById(
      "geruchsbehandlungCheckbox"
    );
    const impraegnierungCheckbox = document.getElementById(
      "impraegnierungCheckbox"
    );
    const pickupCheckbox = document.getElementById("pickupCheckbox");
    const addCarpetBtn = document.getElementById("addCarpet");
    const carpetList = document.getElementById("carpetList");
    const sendRequestBtn = document.getElementById("sendRequest");
    const calculatorDiv = document.querySelector('.calculator');
    const contactFormDiv = document.querySelector('.contact-form');
    const totalPriceDisplay = document.getElementById('totalPriceDisplay');

    function calculateTotal() {
      const area = width * length;
      let currentCarpetTotal = area * selectedPrice;

      if (geruchsbehandlung) {
        currentCarpetTotal += area * 5;
      }

      if (impraegnierung) {
        currentCarpetTotal += area * 5;
      }

      currentCarpetPriceDisplay.textContent = `Preis des aktuellen Teppichs: ${currentCarpetTotal.toFixed(2)} €`;
      updateTotalDisplay();
      return currentCarpetTotal;
    }

    function getFinalTotal() {
      let finalTotal = totalSum;
      if (pickupDesired && finalTotal <= 99) {
        finalTotal += 20;
      }
      return finalTotal;
    }

    function updateTotalDisplay() {
      totalDisplay.textContent = `Gesamtpreis: ${getFinalTotal().toFixed(2)} €`;
    }

    function resetFields() {
      width = 2;
      length = 2;
      selectedPrice = 9.9;
      impraegnierung = false;
      geruchsbehandlung = false;

      widthRange.value = width;
      lengthRange.value = length;
      widthValueDisplay.textContent = width.toFixed(1);
      lengthValueDisplay.textContent = length.toFixed(1);
      geruchsbehandlungCheckbox.checked = false;
      impraegnierungCheckbox.checked = false;

      priceButtons.forEach((btn) => btn.classList.remove("active"));
      priceButtons[0].classList.add("active");
      calculateTotal();
    }

    widthRange.addEventListener("input", (e) => {
      width = parseFloat(e.target.value);
      widthValueDisplay.textContent = width.toFixed(1);
      calculateTotal();
    });

    lengthRange.addEventListener("input", (e) => {
      length = parseFloat(e.target.value);
      lengthValueDisplay.textContent = length.toFixed(1);
      calculateTotal();
    });

    priceButtons.forEach((button) => {
      button.addEventListener("click", (e) => {
        selectedPrice = parseFloat(button.getAttribute("data-price"));

        priceButtons.forEach((btn) => btn.classList.remove("active"));
        button.classList.add("active");

        calculateTotal();
      });
    });

    geruchsbehandlungCheckbox.addEventListener("change", (e) => {
      geruchsbehandlung = e.target.checked;
      calculateTotal();
    });

    impraegnierungCheckbox.addEventListener("change", (e) => {
      impraegnierung = e.target.checked;
      calculateTotal();
    });

    pickupCheckbox.addEventListener("change", (e) => {
      pickupDesired = e.target.checked;
      updateTotalDisplay();
    });

    addCarpetBtn.addEventListener("click", () => {
      const total = calculateTotal();

      const carpetData = {
        width,
        length,
        selectedPrice,
        impraegnierung,
        geruchsbehandlung,
        total,
      };

      totalCarpets.push(carpetData);
      totalSum += total;

      const listItem = document.createElement("li");
      listItem.classList.add("carpet-item");
      listItem.innerHTML = `Teppich: ${width.toFixed(1)}m x ${length.toFixed(
        1
      )}m, Preis: ${total.toFixed(
        2
      )}€ <button class="delete-button"><svg class="w-[24px] h-[24px]  dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
      <path stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 7h14m-9 3v8m4-8v8M10 3h4a1 1 0 0 1 1 1v3H9V4a1 1 0 0 1 1-1ZM6 7h12v13a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V7Z"/>
    </svg>
    </button>`;
      carpetList.appendChild(listItem);

      // Löschen-Funktion
      listItem.querySelector(".delete-button").addEventListener("click", () => {
        carpetList.removeChild(listItem);
        totalCarpets = totalCarpets.filter((item) => item !== carpetData);
        totalSum -= total;
        updateTotalDisplay();
      });

      updateTotalDisplay();
      resetFields();
    });

    sendRequestBtn.addEventListener("click", () => {
      if (totalCarpets.length === 0) {
        alert("Bitte fügen Sie mindestens einen Teppich hinzu, bevor Sie fortfahren.");
        return;
      }
      showContactForm();
    });

    function showContactForm() {
      calculatorDiv.style.display = 'none';
      contactFormDiv.style.display = 'block';
      totalPriceDisplay.textContent = getFinalTotal().toFixed(2);
    }

    document.getElementById('submitContact').addEventListener('click', submitContactForm);

    function submitContactForm() {
      const name = document.getElementById('contactName').value;
      const email = document.getElementById('contactEmail').value;
      const phone = document.getElementById('contactPhone').value;
      const message = document.getElementById('contactMessage').value;
        const consent = document.getElementById('contactConsent').checked;
      const totalPrice = getFinalTotal().toFixed(2);

      if (name && email && phone && consent) {
        // Bereite die E-Mail-Inhalte vor
        let emailContent = `
Name: ${name}
E-Mail: ${email}
Telefonnummer: ${phone}
Nachricht: ${message}
Anzahl Teppiche: ${totalCarpets.length}
Zusatzoptionen:
`;

        totalCarpets.forEach((carpet, index) => {
          emailContent += `
Teppich ${index + 1}:
  Größe: ${carpet.width}m x ${carpet.length}m
  Preis pro m²: ${carpet.selectedPrice}€
  Imprägnierung: ${carpet.impraegnierung ? 'Ja' : 'Nein'}
  Hygienebehandlung: ${carpet.geruchsbehandlung ? 'Ja' : 'Nein'}
  Teppichpreis: ${carpet.total.toFixed(2)}€
`;
        });

        emailContent += `
Gesamtsumme: ${totalPrice}€
Abholung gewünscht: ${pickupDesired ? 'Ja' : 'Nein'}
`;

        const params = {
          from_name: name,
          email: email,
          contact_number: phone,
          message: emailContent,
        };

        emailjs.send('service_xfgt61q', 'template_8ygoui3', params)
          .then((response) => {
            console.log('SUCCESS!', response.status, response.text);
            showThankYouMessage();
          }, (error) => {
            console.log('FAILED...', error);
            alert('Fehler beim Senden der E-Mail');
          });
      } else {
        alert('Bitte füllen Sie alle Felder aus.');
      }
    }

    function showThankYouMessage() {
      let thankYouMessage = 'Vielen Dank! ';

      if (pickupDesired) {
        thankYouMessage += 'Ihre Teppiche werden samstags abgeholt. Die Uhrzeit wird Ihnen freitags bekannt gegeben. Sie erhalten eine Auftragsbestätigung per Telefon oder E-Mail.';
      } else {
        thankYouMessage += 'Sie erhalten eine Auftragsbestätigung per Telefon oder E-Mail.';
      }

      contactFormDiv.innerHTML = `<h2
        class="text-left max-w-2xl mb-4 text-xl font-extrabold tracking-tight leading-none md:text-3xl xl:text-4xl"
      >${thankYouMessage}</h2>`;
    }

    // Initialisierung
    calculateTotal();
    updateTotalDisplay();
  </script>
</body>
</html>
